
我現在要新增一個 command line 指令，修改三個指令的功能。
新增一個dpaddr。這個指令的功能與hdmiaddr類似，是用來提供整個程式 i2c slave address，避免反覆輸入i2c slave address
但是 dpaddr 較為簡單，僅儲存使用者輸入的i2c slave address到變數中，不做其他事情。
這個i2c slave address變數將用來控制 dp re-driver。
當使用者輸入 dpaddr時，清除 HDMI_addr 變數。避免操作混淆。
當使用者輸入 dpaddr時, 也同時將 dp i2c slave address的 Offset 0x15 bit[0] REG_EQ_EN 設為1。但是不要動到其他的bit。

---

### Table 22 REGISTER_EQ_EN

* **Name**: REGISTER_EQ_EN
* **I2C Address**: 0x7c
* **Offset**: 0x15

| Bit | Name      | Type | Default value | Description                                                                                                                                                                                                                   |
| --: | --------- | ---- | ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 7:1 | Reserved  | —    | —             | Reserved                                                                                                                                                                                                                      |
|   0 | REG_EQ_EN | R/W  | 0x0           | Enable equalizer / flat gain / output swing selection from pin or register.<br>0: from pin control (default);<br>1: from register control.<br>Register control determines whether EQ / FG / SW use pin mode or register mode. |

---



修改三個指令的功能：
當 dpaddr 輸入之後，原來`eq`, `sw`, `fg`三個指令必須切換到另外三個新指令，假設function name為 dp_eq, dp_sw and dp_fg.



其中dp_eq 

1. 如果使用者不輸入eq 值，僅輸入指令'eq'。則會先讀取 Offset 0x16/0x2a/0x3e/0x52 register 的值( 0x16 對應到 dp lane0 register, 0x2a 對應到 dp lane1 register, 依此類推，每個 lane register的結構都一樣)，先以十進位顯示目前eq值 (bit[7:4] UTX2_EQ_CAP)，再顯示Offset 0x16/0x2a... register 的值。
2. 如果使用者輸入eq 值, 則會先讀取 Offset 0x16/0x2a/0x3e/0x52 register 的值，再使用 user input eq value（十進位）去覆蓋bit[7:4] UTX2_EQ_CAP，但是寫入的時候不要變更其他bit
3. 使用者輸入eq 值的時候，以此eq值去同時修改 lane0/1/2/3 register(Offset 0x16/0x2a/0x3e/0x52)


---

### Lane0

**Table 23 UTX2_PORT_CFG_0**  **EQ (0–15)**

* **Name**: UTX2_PORT_CFG_0
* **I2C Address**: 0x7c
* **Offset**: 0x16

| Bit | Name             | Type | Default value | Description                                                                                                                                                                                  |
| --: | ---------------- | ---- | ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 7:4 | UTX2_EQ_CAP      | R/W  | 0xC           | EQ input source cap (boost gain) selection when UTX2 port is configured as RX input port                                                                                                     |
| 3:2 | UTX2_EQ_INCM     | R/W  | 0x0           | EQ input pair source voltage vs selection (input cm = vs = vgs) when UTX2 port is configured as RX input port.<br>00: VDD18–0.48V,<br>01: VDD18–0.56V,<br>10: VDD18–0.32V,<br>11: VDD18–0.4V |
|   1 | UTX2_LRD_CORE_EN | R/W  | 0x1           | Enable linear redriver core ckt when UTX2 port is configured as RX input port.<br>0: disable, 1: enable                                                                                      |
|   0 | UTX2_BIAS_EN     | R/W  | 0x1           | Enable lane bias current when UTX2 port is configured as RX input port.<br>0: disable, 1: enable                                                                                             |


其中dp_fg

1. 如果使用者不輸入fg 值，僅輸入指令'fg'。則會先讀取 Offset 0x18/0x2c/0x40/0x54 register 的值( 0x18 對應到 dp lane0 register, 0x2c 對應到 dp lane1 register, 依此類推，每個 lane register的結構都一樣)，先以十進位顯示目前fg值 (bit[5:4] UTX2_VGA_GAIN)，再顯示Offset 0x18/0x2c... register 的值。
2. 如果使用者輸入fg 值, 則會先讀取 Offset 0x18/0x2c/0x40/0x54 register 的值，再使用 user input eq value（十進位）去覆蓋bit[5:4] UTX2_VGA_GAIN，但是寫入的時候不要變更其他bit
3. 使用者輸入fg 值的時候，以此fg值去同時修改 lane0/1/2/3 register(Offset 0x18/0x2c/0x40/0x54)


### Lane0
**Table 25 UTX2_PORT_CFG_2**

*   **Name:** UTX2_PORT_CFG_2
*   **I2C Address:** 0x7c
*   **Offset:** 0x18
*   **FG(0~3)**

| Bit | Name | Type | Default value | Description |
| :--- | :--- | :--- | :--- | :--- |
| 7:6 | UTX2_VGA_IDAC | R/W | 0x3 | vga stage bias current selection when UTX2 port is configured as RX input port. 00: 11: |
| 5:4 | UTX2_VGA_GAIN | R/W | 0x3 | vga gain selection when UTX2 port is configured as RX input port, combined with REG_UTX2_VGA_GAIN_HIGH.<br>REG_UTX2_VGA_GAIN_HIGH=0: 000:0.7dB, 001:1.7dB, 010:2.7dB, 011:3.7 dB;<br>REG_UTX2_VGA_GAIN_HIGH=1, 100:2.3dB, 101:3.3dB, 110:4.3dB ,111:5.3dB |
| 3:0 | UTX2_EQ_RES | R/W | 0x8 | LEQ eq input source resistance selection when UTX2 port is configured as RX input port. 1000 @13.5Gbps<br>1100 @20Gbps |






其中dp_sw

1. 如果使用者不輸入sw 值，僅輸入指令'sw'。則會先讀取 Offset 0x1a/0x2e/0x42/0x56 register 的值( 0x18 對應到 dp lane0 register, 0x2c 對應到 dp lane1 register, 依此類推，每個 lane register的結構都一樣)，先以十進位顯示目前fg值 (bit[1:0] UTX2_DRV_SWING)，再顯示Offset 0x1a/0x2c... register 的值。
2. 如果使用者輸入sw 值, 則會先讀取 Offset 0x1a/0x2e/0x42/0x56 register 的值，再使用 user input eq value（十進位）去覆蓋bit[1:0] UTX2_DRV_SWING，但是寫入的時候不要變更其他bit
3. 使用者輸入sw 值的時候，以此sw值去同時修改 lane0/1/2/3 register(Offset 0x1a/0x2e/0x42/0x56)


---
### Lane0
### Table 27 UTX2_PORT_CFG_4  **SW[0–3]**

* **Name**: UTX2_PORT_CFG_4
* **I2C Address**: 0x7c
* **Offset**: 0x1A

| Bit | Name             | Type | Default value | Description                                                                                                                                                                        |
| --: | ---------------- | ---- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 7:6 | UTX2_LFPS_VTH    | R/W  | 0x1           | LFPS detection threshold voltage selection when UTX2 port is configured as RX input port.<br>00: 160 mVppd,<br>01: 200 mVppd,<br>10: 240 mVppd,<br>11: 280 mVppd                   |
|   5 | UTX2_LFPS_EN     | R/W  | 0x0           | Enable LFPS detection when UTX2 port is configured as RX input port.<br>0: disable, 1: enable                                                                                      |
|   4 | UTX2_RTERM60K_EN | R/W  | 0x1           | Enable 60K ohms input resistance during reset or RX termination not powered when DRX2 port is configured as RX input port.<br>0: disable (Hi-Z), 1: enable (60K)                   |
| 3:2 | UTX2_RTERM_PAC   | R/W  | 0x0           | Input termination resistance configuration to obtain AC peaking when DRX2 port is configured as RX input port (top 2 boost gain)                                                   |
| 1:0 | UTX2_DRV_SWING   | R/W  | 0x2           | Output driver linear range swing selection when UTX2 port is configured as RX input port.<br>00: 10 mA @ 0.8 V,<br>01: 12.5 mA @ 1 V,<br>10: 15 mA @ 1.2 V,<br>11: 17.5 mA @ 1.4 V |




為 `DTX1_PORT_CFG_3` 和 `UTX2_PORT_CFG_1` 這兩個 Register 新增的 command description。

針對 `UTX2_PORT_CFG_1`，由於它同時控制 Middle-Freq Resistance (MFR) 和 Capacitance (MFC)，為了符合 `eq`, `fg` 這種單一參數控制的風格，我將其拆分為兩個指令 `dp_mfr` 和 `dp_mfc` 以方便個別設定。


---

其中 dp_rterm

1. 如果使用者不輸入 rterm 值，僅輸入指令 'dp_rterm'。則會先讀取 Offset 0x23/0x37/0x4B/0x5F register 的值 (0x23 對應到 dp lane0 register, 0x37 對應到 dp lane1 register, 依此類推)，先以十進位顯示目前 rterm 值 (bit[7:3] DTX1_RTERM)，再顯示 Offset 0x23/0x37... register 的值。
2. 如果使用者輸入 rterm 值，則會先讀取 Offset 0x23/0x37/0x4B/0x5F register 的值，再使用 user input rterm value（十進位）去覆蓋 bit[7:3] DTX1_RTERM。
3. **重要**：寫入時，無論原本暫存器值為何，必須強制將 bit[1] DTX1_RTERM_EN 設為 1 (Enable)，且不要變更 bit[2] 與 bit[0] 的狀態。
4. 使用者輸入 rterm 值的時候，以此 rterm 值去同時修改 lane0/1/2/3 register (Offset 0x23/0x37/0x4B/0x5F)。

### Lane0
**Table 71 DTX1_PORT_CFG_3**

*   **Name:** DTX1_PORT_CFG_3
*   **I2C Address:** 0x7c
*   **Offset:** 0x23 (Lane0), 0x37 (Lane1), 0x4B (Lane2), 0x5F (Lane3)

| Bit | Name | Type | Default value | Description |
| :--- | :--- | :--- | :--- | :--- |
| 7:3 | DTX1_RTERM | R/W | 0x0 | termination res value selection for DTX1 path.<br>10000~11111:61 ohms; 00000:50 ohms 00001: 00010: 01111:41 ohms ??? |
| 2 | DTX1_RTERM_R0T1 | R/W | 0x0 | termination resistance configuration for RX/TX mode for DTX1 path. 0: used for input resistance termination when DTX1 port is configured as RX input port, 1: used for output driver resistance termination when DTX1 port is configured as RX input port |
| 1 | DTX1_RTERM_EN | R/W | 0x1 | enable termination res for DTX1 path. 0:disable 1: enable |
| 0 | DTX1_VGA_GAIN_HIGH | R/W | 0x0 | vga gain selection when DTX1 port is configured as RX input port, combined with REG_DTX1_VGA_GAIN[1:0]. |


其中 dp_mfr

1. 如果使用者不輸入 mfr 值，僅輸入指令 'dp_mfr'。則會先讀取 Offset 0x17/0x2B/0x3F/0x53 register 的值 (0x17 對應到 dp lane0 register, 0x2B 對應到 dp lane1 register, 依此類推)，先以十進位顯示目前 mfr 值 (bit[5:3] UTX2_EQ_MFR)，再顯示 Offset 0x17/0x2B... register 的值。
2. 如果使用者輸入 mfr 值，則會先讀取 Offset 0x17/0x2B/0x3F/0x53 register 的值，再使用 user input mfr value（十進位）去覆蓋 bit[5:3] UTX2_EQ_MFR，但是寫入的時候不要變更其他 bit。
3. 使用者輸入 mfr 值的時候，以此 mfr 值去同時修改 lane0/1/2/3 register (Offset 0x17/0x2B/0x3F/0x53)。

其中 dp_mfc

1. 如果使用者不輸入 mfc 值，僅輸入指令 'dp_mfc'。則會先讀取 Offset 0x17/0x2B/0x3F/0x53 register 的值，先以十進位顯示目前 mfc 值 (bit[2:0] UTX2_EQ_MFC)，再顯示 Offset 0x17/0x2B... register 的值。
2. 如果使用者輸入 mfc 值，則會先讀取 Offset 0x17/0x2B/0x3F/0x53 register 的值，再使用 user input mfc value（十進位）去覆蓋 bit[2:0] UTX2_EQ_MFC，但是寫入的時候不要變更其他 bit。
3. 使用者輸入 mfc 值的時候，以此 mfc 值去同時修改 lane0/1/2/3 register (Offset 0x17/0x2B/0x3F/0x53)。

### Lane0
**Table 24 UTX2_PORT_CFG_1**

*   **Name:** UTX2_PORT_CFG_1
*   **I2C Address:** 0x7c
*   **Offset:** 0x17 (Lane0), 0x2B (Lane1), 0x3F (Lane2), 0x53 (Lane3)

| Bit | Name | Type | Default value | Description |
| :--- | :--- | :--- | :--- | :--- |
| 7:6 | UTX2_EQ_IDAC | R/W | 0x3 | leq stage bias current selection when UTX2 port is configured as RX input port. 00 @13.5Gbps 10 @20Gbps |
| 5:3 | UTX2_EQ_MFR | R/W | 0x5 | leq middle-freq resistance selection when UTX2 port is configured as RX input port.000: 111 |
| 2:0 | UTX2_EQ_MFC | R/W | 0x6 | leq middle-freq capacitance selection when UTX2 port is configured as RX input port. 000: &nbsp; 111: |